### '재활용' 기능 개발 계획 및 이력

이 문서는 '과거 정산 내역 재활용' 기능의 개발 계획, 현재까지의 작업 내용, 그리고 발생했던 문제점들을 기록하여 추후 개발 재개를 위한 자료로 활용하는 것을 목적으로 합니다.

---

### 1. 기능 목표

사용자가 '완료됨'(archived) 상태의 과거 정산 내역을 선택했을 때, 해당 내역의 참여자, 비용 항목 등을 그대로 복사하여 새로운 '진행중'(active) 상태의 정산 내역을 생성하는 기능입니다. 이를 통해 유사한 멤버로 반복되는 정산 작업을 편리하게 시작할 수 있도록 돕습니다.

### 2. 원래 실행 계획

1.  **UI**: '완료됨' 상태의 정산 내역을 볼 때, 화면에 "이 내역으로 새로 정산하기" 버튼을 표시한다.
2.  **버튼 클릭 시 동작**:
    a. 사용자에게 "이 내역을 복사하여 새로운 정산을 시작하시겠습니까?"와 같은 확인 창을 띄운다.
    b. 사용자가 확인하면, 현재 보고 있는 정산 내역의 데이터(제목, 부제, 참여자, 비용 항목 등)를 읽어온다.
    c. 제목 뒤에 ` (복사본)`을 붙여 새로운 제목을 만든다.
    d. 복사한 데이터와 새로운 제목을 사용하여, `status`가 `active`인 새로운 정산 내역을 데이터베이스에 `INSERT`한다.
    e. 생성이 완료되면, 방금 만든 새로운 정산 내역을 화면에 불러와 사용자가 즉시 편집할 수 있도록 한다.

### 3. 현재까지의 작업 내용

-   `App.jsx`에 `handleReuseSettlement` 함수를 구현하여 상기 실행 계획의 로직을 대부분 구현했습니다.
-   '완료됨' 상태일 때 "이 내역으로 새로 정산하기" 버튼이 화면에 표시되도록 UI 로직을 추가했습니다.
-   데이터베이스에 새로운 정산 내역을 `INSERT`하고, 새로 생성된 ID를 받아와 화면에 로드하는 부분까지 구현했습니다.
-   UI가 즉시 업데이트되지 않는 문제를 해결하기 위해, 목록 상태를 직접 수정하는 'Optimistic Update' 방식을 도입했습니다.

### 4. 발생했던 문제점 (Bugs)

1.  **UI 미갱신 문제**: '재활용'을 통해 새 정산 내역을 생성해도 사이드바 목록이 즉시 업데이트되지 않고, 새로고침해야만 보이는 현상이 지속적으로 발생했습니다. 이로 인해 사용자가 새로 생성된 항목을 인지하지 못하는 문제가 있었습니다.
    -   **시도한 해결책**: Supabase의 실시간 구독(realtime subscription), 컴포넌트 `key` 강제 변경, 부모 컴포넌트에서의 목록 관리 및 수동 갱신(optimistic update) 등 다양한 방법을 시도했으나, 근본적인 원인을 해결하지 못했습니다.

2.  **데이터 저장 오류**: UI 미갱신 문제와 연관된 문제로, 재활용된 항목의 제목 등을 수정한 후 '정산 완료'를 해도 수정된 내용이 저장되지 않는 버그가 발생했습니다. 이는 UI가 갱신되지 않아 잘못된(이전) ID를 참조하면서 발생한 것으로 추정됩니다.

3.  **406 Not Acceptable 에러**: '정산 완료' 시, 데이터베이스에서 변경된 데이터를 다시 `select`하는 과정에서 RLS(Row-Level Security) 정책 등과 충돌하여 `406` 에러가 발생하는 문제가 있었습니다. 이는 `.select()` 구문을 제거하여 해결했습니다.

### 5. 결론

상기 문제들, 특히 UI가 즉시 갱신되지 않는 문제가 다른 기능의 정확성에도 연쇄적으로 영향을 미치고 있어, 안정적인 기능 제공을 위해 **'재활용' 기능의 개발을 잠정 중단하고 관련 코드를 제거**하기로 결정했습니다.

추후 '정산 재활성화' 기능 구현 후, 애플리케이션의 상태 관리 구조가 더 안정화되면 이 문서를 바탕으로 재개발을 시도할 수 있을 것입니다.
